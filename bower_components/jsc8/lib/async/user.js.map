{"version":3,"file":"user.js","sourceRoot":"","sources":["../../src/user.ts"],"names":[],"mappings":"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","sourcesContent":["import { Connection } from \"./connection\";\nimport { isC8Error } from \"./error\";\n\nexport const USER_NOT_FOUND = 1703;\n\nclass User {\n  _connection: Connection;\n  user = \"\";\n  email: string;\n\n  urlPrefix: string = \"/_admin/user\";\n\n  constructor(connection: Connection, user: string, email: string = '') {\n    this.user = user;\n    this._connection = connection;\n    this.email = email;\n  }\n\n  createUser(passwd: string = \"\", active: boolean = true, extra: object = {}) {\n    return this._connection.request(\n      {\n        method: \"POST\",\n        path: this.urlPrefix,\n        body: {\n          user: this.user,\n          email: this.email,\n          passwd: passwd,\n          active,\n          extra\n        }\n      },\n      res => res.body\n    );\n  }\n\n  getUserDeatils() {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${this.user}`\n      },\n      res => res.body\n    );\n  }\n\n  hasUser(): Promise<boolean> {\n    return this.getUserDeatils().then(\n      () => true,\n      (err) => {\n        if (isC8Error(err) && err.errorNum === USER_NOT_FOUND) {\n          return false;\n        }\n        throw err;\n      },\n    );\n  }\n\n  deleteUser() {\n    return this._connection.request(\n      {\n        method: \"DELETE\",\n        path: `${this.urlPrefix}/${this.user}`\n      },\n      res => res.body\n    );\n  }\n\n  _makeModification(\n    config: { active?: boolean; passwd?: string; extra?: object },\n    methodType: string\n  ) {\n    return this._connection.request(\n      {\n        method: methodType,\n        path: `${this.urlPrefix}/${this.user}`,\n        body: {\n          ...config\n        }\n      },\n      res => res.body\n    );\n  }\n\n  modifyUser(config: { active?: boolean; passwd?: string; extra?: object }) {\n    return this._makeModification(config, \"PATCH\");\n  }\n\n  replaceUser(config: { active?: boolean; passwd: string; extra?: object }) {\n    return this._makeModification(config, \"PUT\");\n  }\n\n  getAllDatabases(isFullRequested: boolean = false) {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${this.user}/database`,\n        qs: {\n          full: isFullRequested\n        }\n      },\n      res => res.body\n    );\n  }\n\n  getDatabaseAccessLevel(databaseName: string) {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${this.user}/database/${databaseName}`\n      },\n      res => res.body\n    );\n  }\n\n  clearDatabaseAccessLevel(fabricName: string) {\n    return this._connection.request(\n      {\n        method: \"DELETE\",\n        path: `${this.urlPrefix}/${this.user}/database/${fabricName}`\n      },\n      res => res.body\n    );\n  }\n\n  setDatabaseAccessLevel(fabricName: string, permission: \"rw\" | \"ro\" | \"none\") {\n    return this._connection.request(\n      {\n        method: \"PUT\",\n        path: `${this.urlPrefix}/${this.user}/database/${fabricName}`,\n        body: {\n          grant: permission\n        }\n      },\n      res => res.body\n    );\n  }\n\n  getCollectionAccessLevel(databaseName: string, collectionName: string) {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${\n          this.user\n          }/database/${databaseName}/collection/${collectionName}`\n      },\n      res => res.body\n    );\n  }\n\n  clearCollectionAccessLevel(fabricName: string, collectionName: string) {\n    return this._connection.request(\n      {\n        method: \"DELETE\",\n        path: `${this.urlPrefix}/${\n          this.user\n          }/database/${fabricName}/collection/${collectionName}`\n      },\n      res => res.body\n    );\n  }\n\n  setCollectionAccessLevel(\n    fabricName: string,\n    collectionName: string,\n    permission: \"rw\" | \"ro\" | \"none\"\n  ) {\n    return this._connection.request(\n      {\n        method: \"PUT\",\n        path: `${this.urlPrefix}/${\n          this.user\n          }/database/${fabricName}/collection/${collectionName}`,\n        body: {\n          grant: permission\n        }\n      },\n      res => res.body\n    );\n  }\n\n  listAvailableUsers() {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}`\n      },\n      res => res.body\n    );\n  }\n\n  getStreamAccessLevel(databaseName: string, streamName: string) {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${\n          this.user\n          }/database/${databaseName}/stream/${streamName}`\n      },\n      res => res.body\n    );\n  }\n\n  clearStreamAccessLevel(databaseName: string, streamName: string) {\n    return this._connection.request(\n      {\n        method: \"DELETE\",\n        path: `${this.urlPrefix}/${\n          this.user\n          }/database/${databaseName}/stream/${streamName}`\n      },\n      res => res.body\n    );\n  }\n\n  setStreamAccessLevel(\n    databaseName: string,\n    streamName: string,\n    permission: \"rw\" | \"ro\" | \"none\"\n  ) {\n    return this._connection.request(\n      {\n        method: \"PUT\",\n        path: `${this.urlPrefix}/${\n          this.user\n          }/database/${databaseName}/stream/${streamName}`,\n        body: {\n          grant: permission\n        }\n      },\n      res => res.body\n    );\n  }\n\n  listAccessibleCollections(databaseName: string, isFullRequested: boolean = false) {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${this.user}/database/${databaseName}/collection`,\n        qs: {\n          full: isFullRequested\n        }\n      },\n      res => res.body\n    );\n  }\n\n  listAccessibleStreams(databaseName: string, isFullRequested: boolean = false) {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${this.user}/database/${databaseName}/stream`,\n        qs: {\n          full: isFullRequested\n        }\n      },\n      res => res.body\n    );\n  }\n\n  getBillingAccessLevel() {\n    return this._connection.request(\n      {\n        method: \"GET\",\n        path: `${this.urlPrefix}/${this.user}/billing`\n      },\n      res => res.body\n    );\n  }\n\n  clearBillingAccessLevel() {\n    return this._connection.request(\n      {\n        method: \"DELETE\",\n        path: `${this.urlPrefix}/${this.user}/billing`\n      },\n      res => res.body\n    );\n  }\n\n  setBillingAccessLevel(permission: \"rw\" | \"ro\" | \"none\") {\n    return this._connection.request(\n      {\n        method: \"PUT\",\n        path: `${this.urlPrefix}/${this.user}/billing`,\n        body: {\n          grant: permission\n        }\n      },\n      res => res.body\n    );\n  }\n}\n\nexport default User;\n"]}